(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chooseSchool/qianming"],{"42d4":function(t,e,i){"use strict";(function(t,e){var n=i("47a9");i("1212");n(i("3240"));var a=n(i("d81c"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(a.default)}).call(this,i("3223")["default"],i("df3c")["createPage"])},6564:function(t,e,i){"use strict";(function(t,n){var a=i("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=a(i("7eb4")),c=a(i("ee10")),o=i("dcbd"),r=i("c486"),h={components:{"picker-color":function(){i.e("components/helang-pickerColor/helang-pickerColor").then(function(){return resolve(i("9a5a"))}.bind(null,i)).catch(i.oe)}},data:function(){return{imgList:"",sid:"",buttonColor:"#0099FF",showPickerColor:!1,bottomPickerColor:0,canvasName:"handWriting",ctx:"",canvasWidth:0,canvasHeight:0,transparent:1,selectColor:"black",lineColor:"#1A1A1A",lineSize:1.5,lineMin:.5,lineMax:4,pressure:1,smoothness:60,currentPoint:{},currentLine:[],firstTouch:!0,radius:1,cutArea:{top:0,right:0,bottom:0,left:0},bethelPoint:[],lastPoint:0,chirography:[],currentChirography:{},linePrack:[]}},onLoad:function(e){var i=this;this.sid=e.sid;var n=this.canvasName,a=t.createCanvasContext(n);this.ctx=a;var s=t.createSelectorQuery();s.select(".handCenter").boundingClientRect((function(t){i.canvasWidth=t.width,i.canvasHeight=t.height,i.setCanvasBg("#fff")})).exec()},methods:{tjqianming:function(){var t=this;return(0,c.default)(s.default.mark((function e(){var i,a,c,o;return s.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t,e.prev=1,a={id:i.sid,contractSign:i.imgList},e.next=5,(0,r.getupContractSign)(a);case 5:c=e.sent,o=c.data,200==o.code?(t.$api.msg("提交成功"),setTimeout((function(){n.navigateBack({delta:1})}),500)):t.$api.msg(o.msg),e.next=12;break;case 10:e.prev=10,e.t0=e["catch"](1);case 12:case"end":return e.stop()}}),e,null,[[1,10]])})))()},getPickerColor:function(t){this.showPickerColor=!1,t&&(this.buttonColor=t,this.selectColor=t,this.lineColor=t,console.log("选择的颜色值是："+t))},selectColorEvent:function(t,e){this.showPickerColor=!0,this.selectColor=t,this.lineColor=e},uploadScaleStart:function(t){if("touchstart"!=t.type)return!1;var e=this.ctx;e.setFillStyle(this.lineColor),e.setGlobalAlpha(this.transparent);var i={x:t.touches[0].x,y:t.touches[0].y},n=this.currentLine;n.unshift({time:(new Date).getTime(),dis:0,x:i.x,y:i.y}),this.currentPoint=i,this.firstTouch&&(this.cutArea={top:i.y,right:i.x,bottom:i.y,left:i.x},this.firstTouch=!1),this.pointToLine(n)},uploadScaleMove:function(t){if("touchmove"!=t.type)return!1;t.cancelable&&(t.defaultPrevented||t.preventDefault());var e={x:t.touches[0].x,y:t.touches[0].y};e.y<this.cutArea.top&&(this.cutArea.top=e.y),e.y<0&&(this.cutArea.top=0),e.x>this.cutArea.right&&(this.cutArea.right=e.x),this.canvasWidth-e.x<=0&&(this.cutArea.right=this.canvasWidth),e.y>this.cutArea.bottom&&(this.cutArea.bottom=e.y),this.canvasHeight-e.y<=0&&(this.cutArea.bottom=this.canvasHeight),e.x<this.cutArea.left&&(this.cutArea.left=e.x),e.x<0&&(this.cutArea.left=0),this.lastPoint=this.currentPoint,this.currentPoint=e;var i=this.currentLine;i.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint),x:e.x,y:e.y}),this.pointToLine(i)},uploadScaleEnd:function(t){if("touchend"!=t.type)return 0;var e={x:t.changedTouches[0].x,y:t.changedTouches[0].y};this.lastPoint=this.currentPoint,this.currentPoint=e;var i=this.currentLine;if(i.unshift({time:(new Date).getTime(),dis:this.distance(this.currentPoint,this.lastPoint),x:e.x,y:e.y}),i.length>2)i[0].time,i[i.length-1].time,i.length;this.pointToLine(i);var n={lineSize:this.lineSize,lineColor:this.lineColor},a=this.chirography;a.unshift(n),this.chirography=a;var s=this.linePrack;s.unshift(this.currentLine),this.linePrack=s,this.currentLine=[]},retDraw:function(){this.ctx.clearRect(0,0,700,730),this.ctx.draw(),this.setCanvasBg("#fff")},pointToLine:function(t){this.calcBethelLine(t)},calcBethelLine:function(t){if(t.length<=1)t[0].r=this.radius;else{var e,i,n,a,s,c,o,r,h,l,u=0,f=0;t.length<=2?(e=t[1].x,a=t[1].y,n=t[1].x+.5*(t[0].x-t[1].x),c=t[1].y+.5*(t[0].y-t[1].y),i=e+.5*(n-e),s=a+.5*(c-a)):(e=t[2].x+.5*(t[1].x-t[2].x),a=t[2].y+.5*(t[1].y-t[2].y),i=t[1].x,s=t[1].y,n=i+.5*(t[0].x-i),c=s+.5*(t[0].y-s)),h=this.distance({x:n,y:c},{x:e,y:a}),l=this.radius;for(var d=0;d<t.length-1;d++)if(u+=t[d].dis,f+=t[d].time-t[d+1].time,u>this.smoothness)break;this.radius=Math.min(f/h*this.pressure+this.lineMin,this.lineMax)*this.lineSize,t[0].r=this.radius,t.length<=2?(o=(l+this.radius)/2,r=o,r):(o=(t[2].r+t[1].r)/2,r=t[1].r,(t[1].r+t[0].r)/2);for(var x=[],y=0;y<5;y++){var v=y/4,p=(1-v)*(1-v)*e+2*v*(1-v)*i+v*v*n,g=(1-v)*(1-v)*a+2*v*(1-v)*s+v*v*c,m=l+(this.radius-l)/5*y;if(x.push({x:p,y:g,r:m}),3==x.length){var P=this.ctaCalc(x[0].x,x[0].y,x[0].r,x[1].x,x[1].y,x[1].r,x[2].x,x[2].y,x[2].r);P[0].color=this.lineColor,this.bethelDraw(P,1),x=[{x:p,y:g,r:m}]}}this.currentLine=t}},distance:function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},ctaCalc:function(t,e,i,n,a,s,c,o,r){var h,l,u,f,d,x,y,v,p,g=[];h=n-t,l=a-e,u=2*Math.sqrt(h*h+l*l+1e-4),h=h/u*i,l=l/u*i,f=l,d=-h,x=n-c,y=a-o,u=2*Math.sqrt(x*x+y*y+1e-4),x=x/u*r,y=y/u*r,v=-y,p=x,g.push({mx:t+f,my:e+d,color:"#1A1A1A"}),g.push({c1x:n+f,c1y:a+d,c2x:n+v,c2y:a+p,ex:c+v,ey:o+p}),g.push({c1x:c+v-x,c1y:o+p-y,c2x:c-v-x,c2y:o-p-y,ex:c-v,ey:o-p}),g.push({c1x:n-v,c1y:a-p,c2x:n-f,c2y:a-d,ex:t-f,ey:e-d}),g.push({c1x:t-f-h,c1y:e-d-l,c2x:t+f-h,c2y:e+d-l,ex:t+f,ey:e+d}),g[0].mx=g[0].mx.toFixed(1),g[0].mx=parseFloat(g[0].mx),g[0].my=g[0].my.toFixed(1),g[0].my=parseFloat(g[0].my);for(var m=1;m<g.length;m++)g[m].c1x=g[m].c1x.toFixed(1),g[m].c1x=parseFloat(g[m].c1x),g[m].c1y=g[m].c1y.toFixed(1),g[m].c1y=parseFloat(g[m].c1y),g[m].c2x=g[m].c2x.toFixed(1),g[m].c2x=parseFloat(g[m].c2x),g[m].c2y=g[m].c2y.toFixed(1),g[m].c2y=parseFloat(g[m].c2y),g[m].ex=g[m].ex.toFixed(1),g[m].ex=parseFloat(g[m].ex),g[m].ey=g[m].ey.toFixed(1),g[m].ey=parseFloat(g[m].ey);return g},bethelDraw:function(t,e,i){var n=this.ctx;n.beginPath(),n.moveTo(t[0].mx,t[0].my),void 0!=i?(n.setFillStyle(i),n.setStrokeStyle(i)):(n.setFillStyle(t[0].color),n.setStrokeStyle(t[0].color));for(var a=1;a<t.length;a++)n.bezierCurveTo(t[a].c1x,t[a].c1y,t[a].c2x,t[a].c2y,t[a].ex,t[a].ey);n.stroke(),void 0!=e&&n.fill(),n.draw(!0)},canvasToImg:function(e){this.ctx.draw(!0,(function(){t.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(i){t.showToast({title:"执行了吗？"}),e(i.tempFilePath)}})}))},subCanvas:function(){this.ctx.draw(!0,(function(){t.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(e){t.showToast({title:"以保存"}),t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){t.showToast({title:"已成功保存到相册",duration:2e3})}})}})}))},saveCanvasAsImg:function(){t.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(e){t.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){t.showToast({title:"已保存到相册",duration:2e3})}})}})},previewCanvasImg:function(){t.canvasToTempFilePath({canvasId:"handWriting",fileType:"jpg",quality:1,success:function(e){t.previewImage({urls:[e.tempFilePath]})}})},uploadCanvasImg:function(){var e=this;t.canvasToTempFilePath({canvasId:"handWriting",fileType:"png",quality:1,success:function(i){var a=i.tempFilePath;t.uploadFile({url:o.baseUrl+"hs/api/upload",filePath:a,name:"file",formData:{token:n.getStorageSync("token")},success:function(t){var i=JSON.parse(t.data);200==i.code?(e.imgList=i.fileName,console.log(e.imgList),e.tjqianming()):n.showToast({title:i.msg,icon:"none"})}})}})},setCanvasBg:function(t){this.ctx.rect(0,0,this.canvasWidth,this.canvasHeight-4),this.ctx.setFillStyle(t),this.ctx.fill(),this.ctx.draw()}}};e.default=h}).call(this,i("3223")["default"],i("df3c")["default"])},"8e3c":function(t,e,i){"use strict";i.r(e);var n=i("6564"),a=i.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=a.a},b644:function(t,e,i){},d81c:function(t,e,i){"use strict";i.r(e);var n=i("fd0c"),a=i("8e3c");for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);i("e5ec");var c=i("828b"),o=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=o.exports},e5ec:function(t,e,i){"use strict";var n=i("b644"),a=i.n(n);a.a},fd0c:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return a})),i.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},a=[]}},[["42d4","common/runtime","common/vendor"]]]);